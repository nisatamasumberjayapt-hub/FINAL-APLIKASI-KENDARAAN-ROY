<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kendaraan | PT ANISA JAYA UTAMA â€” BY ROY</title>
  <style>
    :root{
      --accent:#0c5d27; --accent2:#13904a;
      --danger:#c0392b; --warn:#f1c40f; --ok:#2ecc71;
      --soft:#f6faf7;
    }
    *{box-sizing:border-box;font-family:"Poppins",sans-serif}
    body{background:var(--soft);margin:0;color:#123}
    header{
      background:var(--accent);
      color:#fff;
      padding:12px 18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .brand { font-weight:700; display:flex; align-items:center; gap:10px; }
    .user-info { display:flex; align-items:center; gap:10px; font-weight:600; }
    .user-emoji { width:34px; height:34px; border-radius:50%; background:#fff1; display:flex; align-items:center; justify-content:center; color:#fff; font-size:18px; }

    nav a{ color:#fff; text-decoration:none; margin-left:12px; font-weight:500 }
    main{ max-width:1600px; margin:36px auto; padding:0 20px; }

    /* Grid: form (narrow) + table (lebih luas) */
    .grid{ display:grid; grid-template-columns:360px 1fr; gap:32px; align-items:start; }

    .card{ background:#fff; border-radius:14px; box-shadow:0 5px 15px rgba(0,0,0,.08); padding:22px; transition:.15s; }
    .card h2{ margin:0 0 18px; color:var(--accent); font-size:18px; text-align:center; text-transform:uppercase; letter-spacing:0.6px }

    /* Form */
    label{ display:block; margin:10px 0 6px; font-weight:700; font-size:13px; color:#244; text-transform:uppercase }
    input[type="text"], input[type="date"]{
      width:100%; padding:10px 12px; border:1.5px solid #d9e4da; border-radius:8px; font-size:14px;
    }
    input:disabled{ background:#f7f9f7; opacity:.9 }
    input:focus{ outline:none; border-color:var(--accent2); box-shadow:0 0 0 4px rgba(19,144,74,0.08) }

    /* force uppercase for plat & letak */
    #plat, #letak { text-transform:uppercase; }

    .row-btn{ display:flex; gap:12px; justify-content:center; margin-top:18px }
    .btn{
      border:none; border-radius:8px; padding:10px 16px; font-weight:700; cursor:pointer; transition:.15s;
      box-shadow:0 4px 12px rgba(0,0,0,0.06);
    }
    .btn-primary{ background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#fff; }
    .btn-primary:hover{ filter:brightness(1.04) }
    /* batal style: light (not black) to be distinguishable when active */
    .btn-cancel{ background: linear-gradient(135deg,#f0f0f0,#ffffff); color:#333; border:1px solid #e0e0e0; }
    .btn-cancel:disabled{ opacity:.6; cursor:not-allowed; filter:none }

    /* Search + table area */
    .search-wrap{ position:relative; margin-bottom:12px; display:flex; gap:10px; align-items:center }
    #searchInput{ flex:1; padding:10px 12px; border-radius:8px; border:1.5px solid #dbe5dc; font-size:14px }
    #clearSearch{
      background:#c0392b; color:#fff; border:none; border-radius:8px; padding:8px 10px; cursor:pointer; display:none;
    }

    /* Table wide + taller */
    .table-wrap{
      max-height:760px; /* diperpanjang untuk lebih panjang ke bawah */
      overflow:auto; border-radius:10px; border:1px solid #e3eee3; box-shadow:inset 0 0 8px rgba(0,0,0,0.04);
      overflow-x:auto;
    }
    table{ width:130%; /* lebarkan tabel ~30% dengan memberi width lebih dari container */ border-collapse:collapse; font-size:14px; table-layout: auto; }
    th, td{ padding:12px 16px; border-bottom:1px solid #e7f1e8; vertical-align:middle; white-space:nowrap; text-align:left; }
    thead th{ background:var(--accent); color:#fff; text-transform:uppercase; position:sticky; top:0; z-index:2; font-size:13px }
    thead th:nth-child(1){ min-width:130px } /* Plat */
    thead th:nth-child(2){ min-width:160px } /* Letak */
    thead th:nth-child(3){ min-width:160px } /* STNK */
    thead th:nth-child(4){ min-width:160px } /* KIR */
    thead th:nth-child(5){ min-width:210px } /* Servis */
    thead th:nth-child(6){ min-width:210px } /* Pajak */
    thead th:nth-child(7){ min-width:140px } /* Aksi */

    tbody td small{ display:block; color:#555; margin-top:4px; font-size:12px }
    tbody tr:hover{ background:#f9fcf9 }

    .dot{ width:12px; height:12px; border-radius:3px; display:inline-block; margin-right:8px; vertical-align:middle }
    .action-btn{ border:none; border-radius:7px; padding:8px 12px; font-weight:700; cursor:pointer; margin-right:6px }
    .edit{ background:#f1c40f; color:#000 }
    .del{ background:var(--danger); color:#fff }

    /* toast */
    #toast-container{ position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); display:flex; flex-direction:column; gap:8px; z-index:9999; pointer-events:none }
    .toast{ background:#fff; padding:14px 18px; border-radius:12px; box-shadow:0 6px 24px rgba(0,0,0,0.12); font-weight:700; min-width:260px; border-left:6px solid var(--accent) }
    .toast.success{ border-color:var(--ok) }
    .toast.error{ border-color:var(--danger) }
    .toast.warn{ border-color:var(--warn) }

    @media(max-width:1000px){ .grid{ grid-template-columns:1fr } table{ width:100% } }
  </style>
</head>
<body onload="initKendaraanPage()">
  <header>
    <div class="brand">
      <div style="font-size:20px">ğŸš—</div>
      <div>
        <div style="font-size:16px;font-weight:800">PT ANISA JAYA UTAMA</div>
        <div style="font-size:12px;opacity:0.9">BY ROY</div>
      </div>
    </div>

    <!-- user info (nama + role). akan diisi oleh script di bawah -->
    <div class="user-info" id="userArea" style="margin-left:auto">
      <!-- default before script runs -->
      <div class="user-emoji">ğŸ™‚</div>
      <div id="userName" style="text-transform:capitalize">Tamu</div>
      <nav id="miniNav"></nav>
    </div>
  </header>

  <main>
    <div class="grid">
      <!-- FORM -->
      <section class="card">
        <h2>ğŸ§¾ FORM KENDARAAN</h2>

        <label>PLAT NOMOR</label>
        <input id="plat" type="text" placeholder="Contoh: B1234XYZ" disabled />

        <label>LETAK / GARASI</label>
        <input id="letak" type="text" placeholder="Contoh: JAKARTA" disabled />

        <label>STNK</label>
        <input id="stnk" type="date" disabled />

        <label>KIR</label>
        <input id="kir" type="date" disabled />

        <label>SERVIS TERAKHIR</label>
        <input id="servis" type="date" disabled />

        <label>PAJAK 5 TAHUNAN</label>
        <input id="pajak5" type="date" disabled />

        <div class="row-btn">
          <button id="btnPrimary" class="btn btn-primary" onclick="handlePrimaryClick()">â• Tambah</button>
          <button id="btnCancel" class="btn btn-cancel" onclick="handleCancel()" disabled>âŒ Batal</button>
        </div>
      </section>

      <!-- TABLE -->
      <section class="card">
        <h2>ğŸ“‹ DAFTAR KENDARAAN</h2>

        <div class="search-wrap">
          <input id="searchInput" type="text" placeholder="ğŸ” Cari kendaraan (Plat / Letak)">
          <button id="clearSearch" title="Hapus pencarian">âŒ</button>
        </div>

        <div class="table-wrap">
          <table id="tblKendaraan">
            <thead>
              <tr>
                <th>ğŸ”  PLAT NOMOR</th>
                <th>ğŸ“ LETAK</th>
                <th>ğŸ§¾ STNK</th>
                <th>ğŸ› KIR</th>
                <th>ğŸ”§ SERVIS</th>
                <th>ğŸ’° PAJAK 5 TAHUNAN</th>
                <th>âš™ï¸ AKSI</th>
              </tr>
            </thead>
            <tbody>
              <tr><td colspan="7" align="center">Memuat data...</td></tr>
            </tbody>
          </table>
        </div>
      </section>
    </div>
  </main>

  <div id="toast-container"></div>

  <!-- gunakan main.js utama (jangan ubah) -->
  <script src="main.js?v=7.5"></script>

  <!-- sedikit script tampilan: tampilkan nama admin di header tanpa merubah logika -->
  <script>
    (function(){
      // getSession di-def oleh main.js â€” pastikan main.js sudah dimuat
      // jika main.js belum mendefinisikan getSession (rare), kita fallback.
      function safeGetSession(){
        try { return getSession(); } catch(e) { return null; }
      }

      const user = safeGetSession();
      const userNameEl = document.getElementById('userName');
      const miniNav = document.getElementById('miniNav');
      const userEmoji = document.querySelector('.user-emoji');

      if(user && user.nama){
        // tampilkan nama dan role (jika admin)
        userNameEl.textContent = user.nama;
        // emoji acak kecil (agar lucu), konsisten per username via char code
        const seed = (user.username || user.nama).split('').reduce((s,ch)=>s+ch.charCodeAt(0),0);
        const emojis = ['ğŸš€','ğŸ¦Š','ğŸµ','ğŸ¦','ğŸ¼','ğŸ¯','ğŸ¦„','ğŸ¸','ğŸ§','ğŸ™'];
        userEmoji.textContent = emojis[seed % emojis.length];

        // nav: kalau admin tampilkan link dashboard,kendaraan,user,logout; jika bukan admin tampilkan logout
        if(user.role === 'admin'){
          miniNav.innerHTML = `
            <a href="dashboard.html" style="margin-left:12px;color:#fff;text-decoration:none">ğŸ </a>
            <a href="kendaraan.html" style="margin-left:8px;color:#fff;text-decoration:none">ğŸš—</a>
            <a href="user.html" style="margin-left:8px;color:#fff;text-decoration:none">ğŸ‘¤</a>
            <a href="#" style="margin-left:8px;color:#fff;text-decoration:none" onclick="logout()">ğŸ”’</a>
          `;
        } else {
          miniNav.innerHTML = `<a href="#" style="margin-left:8px;color:#fff;text-decoration:none" onclick="logout()">ğŸ”’</a>`;
        }
      } else {
        userNameEl.textContent = 'Tamu';
        userEmoji.textContent = 'ğŸ™‚';
        miniNav.innerHTML = `<a href="login.html" style="margin-left:8px;color:#fff;text-decoration:none">ğŸ”‘</a>`;
      }

      // hook untuk clear search (jika initKendaraanPage belum attached listener)
      const s = document.getElementById('searchInput');
      const clearBtn = document.getElementById('clearSearch');
      function applyFilterAndToggle(){
        const q = (s.value || '').trim();
        // reuse existing filter() function from onboard script if present
        try { if (typeof filter === 'function') filter(); else {
          // fallback: simple hide rows
          document.querySelectorAll('#tblKendaraan tbody tr').forEach(r=>{
            r.style.display = r.innerText.toLowerCase().includes(q.toLowerCase()) ? '' : 'none';
          });
        } } catch(e){}
        clearBtn.style.display = q ? 'inline-block' : 'none';
      }
      s.addEventListener('input', applyFilterAndToggle);
      clearBtn.addEventListener('click', ()=>{ s.value=''; applyFilterAndToggle(); s.focus(); });

      // ensure buttons text state sync after page load (initKendaraanPage will call syncBtn too)
      setTimeout(()=>{ try { if (typeof syncBtn === 'function') syncBtn(); } catch(e){} }, 400);
    })();
  </script>
</body>
</html>
