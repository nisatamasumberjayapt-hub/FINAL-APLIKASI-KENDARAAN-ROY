<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KENDARAAN | PT ANISA JAYA UTAMA ‚Äî BY ROY</title>

  <style>
    :root {
      --accent: #0c5d27;
      --accent-strong: #0b4d1b;
    }
    * {
      box-sizing: border-box;
      font-family: 'Poppins', system-ui, sans-serif;
    }
    body {
      background: linear-gradient(180deg, #f6f9ff 0%, #edf4ff 100%);
      margin: 0;
      color: #123;
    }

    /* HEADER */
    header {
      background: var(--accent);
      color: #fff;
      padding: 14px 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      position: sticky;
      top: 0;
      z-index: 50;
    }
    header nav a {
      color: #fff;
      text-decoration: none;
      margin-left: 18px;
      font-weight: 500;
    }

    main {
      max-width: 1200px;
      margin: 28px auto;
      padding: 0 16px;
      animation: fadeSlide 0.4s ease;
    }

    /* GRID */
    .grid {
      display: grid;
      grid-template-columns: 340px 1fr;
      gap: 24px;
      align-items: start;
    }

    /* CARD */
    .card {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(12, 59, 27, 0.06);
      padding: 20px;
      animation: fadeSlide 0.4s ease;
    }

    h2 {
      margin: 0 0 16px;
      color: var(--accent-strong);
      text-align: center;
      font-weight: 700;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    /* FORM */
    label {
      display: block;
      font-weight: 600;
      font-size: 13px;
      margin: 10px 0 6px;
      color: var(--accent-strong);
    }
    input[type="text"], input[type="date"] {
      width: 100%;
      padding: 10px 12px;
      border: 1.3px solid #cdd9cd;
      border-radius: 8px;
      font-size: 14px;
      outline: none;
      transition: 0.2s;
    }
    input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 6px rgba(12,93,39,0.2);
    }

    .row-btn {
      display: flex;
      gap: 10px;
      margin-top: 16px;
    }
    .btn {
      border: none;
      border-radius: 8px;
      padding: 10px 14px;
      font-weight: 700;
      cursor: pointer;
      transition: 0.2s;
    }
    .btn-primary { background: var(--accent); color: #fff; }
    .btn-secondary { background: #777; color: #fff; }
    .btn-danger { background: #e74c3c; color: #fff; }
    .btn:hover { opacity: 0.9; }

    /* TABEL */
    .toolbar {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 14px;
    }
    #searchInput {
      flex: 1;
      padding: 10px 12px;
      border: 1.5px solid #cdd9cd;
      border-radius: 8px;
    }

    .table-wrap {
      max-height: 65vh;
      overflow-y: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    th, td {
      padding: 10px 14px;
      border-bottom: 1px solid #e0ebe0;
      vertical-align: top;
    }
    thead th {
      background: var(--accent);
      color: #fff;
      text-align: left;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    tbody tr:hover {
      background: rgba(12,93,39,0.05);
      transition: 0.2s;
    }

    /* STATUS */
    .dot {
      width: 12px;
      height: 12px;
      border-radius: 3px;
      display: inline-block;
      margin-right: 6px;
    }
    .dot.green { background: #2ecc71; }
    .dot.yellow { background: #f1c40f; }
    .dot.red { background: #e74c3c; }

    /* MODAL */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .modal-box {
      background: #fff;
      border-radius: 12px;
      padding: 24px 28px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
      width: 320px;
      text-align: center;
      animation: scaleIn 0.25s ease;
    }

    /* TOAST */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 1000;
    }
    .toast {
      background: rgba(255,255,255,0.95);
      border-left: 5px solid var(--accent);
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      padding: 12px 18px;
      min-width: 260px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      animation: fadeInRight 0.4s ease;
    }
    .toast.success { border-left-color: #2ecc71; }
    .toast.error { border-left-color: #e74c3c; }
    .toast.warning { border-left-color: #f1c40f; }

    @keyframes fadeSlide {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeInRight {
      from { opacity: 0; transform: translateX(40px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    @media (max-width: 900px) {
      .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body onload="initKendaraanPage()">
  <header>
    <div><strong>üöó PT ANISA JAYA UTAMA ‚Äî BY ROY</strong></div>
    <nav>
      <a href="dashboard.html">üè† Dashboard</a>
      <a href="user.html">üë§ User</a>
      <a href="login.html">üîí Logout</a>
    </nav>
  </header>

  <main>
    <div class="grid">
      <!-- FORM -->
      <section class="card">
        <h2>üßæ FORM KENDARAAN</h2>
        <label for="plat">Plat Nomor</label>
        <input id="plat" type="text" placeholder="Contoh: B1234XYZ" />

        <label for="letak">Letak / Garasi</label>
        <input id="letak" type="text" placeholder="Contoh: Jakarta" />

        <label for="stnk">STNK</label>
        <input id="stnk" type="date" />

        <label for="kir">KIR</label>
        <input id="kir" type="date" />

        <label for="servis">Servis Terakhir</label>
        <input id="servis" type="date" />

        <label for="pajak5">Pajak 5 Tahunan</label>
        <input id="pajak5" type="date" />

        <div class="row-btn">
          <button id="btnPrimary" class="btn btn-primary" onclick="handlePrimaryClick()">Tambah</button>
          <button id="btnCancel" class="btn btn-secondary" onclick="handleCancel()" disabled>Batal</button>
        </div>
      </section>

      <!-- TABLE -->
      <section class="card">
        <h2>üìã DAFTAR KENDARAAN</h2>

        <div class="toolbar">
          <input id="searchInput" type="text" placeholder="üîç Cari kendaraan (Plat Nomor / Letak)" />
        </div>

        <div class="table-wrap">
          <table id="tblKendaraan">
            <thead>
              <tr>
                <th>Plat Nomor</th>
                <th>Letak</th>
                <th>STNK</th>
                <th>KIR</th>
                <th>Servis Terakhir</th>
                <th>Pajak 5 Tahunan</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div style="margin-top:10px;font-size:13px;">
          <span><span class="dot green"></span> Aman</span>
          <span><span class="dot yellow"></span> Peringatan (‚â§10 hari / Servis ‚â•3 bulan)</span>
          <span><span class="dot red"></span> Lewat (STNK/KIR/Pajak habis)</span>
        </div>
      </section>
    </div>
  </main>

  <!-- Modal hapus -->
  <div id="modalConfirm" class="modal-overlay">
    <div class="modal-box">
      <h3>Konfirmasi Hapus</h3>
      <p id="modalMessage">Apakah Anda yakin ingin menghapus kendaraan ini?</p>
      <div style="display:flex;justify-content:space-around;margin-top:18px;">
        <button id="btnTidak" class="btn btn-secondary">Batal</button>
        <button id="btnYa" class="btn btn-danger">Ya, Hapus</button>
      </div>
    </div>
  </div>

  <div id="toastContainer" class="toast-container"></div>

  <script src="main.js?v=7.4"></script>
  <script>
    let PLAT_HAPUS = "";
    const modal = document.getElementById("modalConfirm");
    document.getElementById("btnTidak").onclick = () => modal.style.display = "none";
    document.getElementById("btnYa").onclick = async () => {
      modal.style.display = "none";
      const res = await api("deleteKendaraan", { Platnomor: PLAT_HAPUS });
      if (res.success) {
        showToast("üóëÔ∏è Kendaraan berhasil dihapus!", "success");
        reloadKendaraanList();
      } else showToast("‚ùå Gagal menghapus!", "error");
    };

    function showModalHapus(plat) {
      PLAT_HAPUS = plat;
      document.getElementById("modalMessage").textContent =
        `Apakah Anda yakin ingin menghapus kendaraan dengan plat ${plat}?`;
      modal.style.display = "flex";
    }

    // Toast elegan
    function showToast(msg, type = "success", dur = 3000) {
      const c = document.getElementById("toastContainer");
      const t = document.createElement("div");
      t.className = "toast " + type;
      t.innerHTML = `<span>${msg}</span><button style="border:none;background:none;cursor:pointer;">‚úñ</button>`;
      c.appendChild(t);
      t.querySelector("button").onclick = () => t.remove();
      setTimeout(() => t.remove(), dur);
    }

    async function initKendaraanPage() {
      const u = getSession();
      if (!u) return (location.href = "login.html");
      await reloadKendaraanList();
      const s = document.getElementById("searchInput");
      s.addEventListener("input", () => {
        const val = s.value.toLowerCase();
        const filtered = DATA.filter(k =>
          k.Platnomor.toLowerCase().includes(val) ||
          k.Letak.toLowerCase().includes(val)
        );
        renderTabelKendaraan(filtered, true);
      });
    }
  </script>
</body>
</html>
