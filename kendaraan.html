<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KENDARAAN | PT ANISA JAYA UTAMA â€” BY ROY</title>

  <style>
    :root {
      --accent:#0c5d27;
      --danger:#c0392b;
      --warn:#f1c40f;
      --ok:#2ecc71;
      --grey:#c7c7c7;
      --greyLight:#e4e4e4;
    }

    * {
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }

    body {
      background:#f6faf7;
      margin:0;
      color:#123;
    }

    /* HEADER */
    header {
      background:var(--accent);
      color:white;
      padding:12px 20px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    header nav a {
      color:white;
      margin-left:16px;
      text-decoration:none;
      font-weight:500;
    }

    /* ADMIN NAME */
    #adminName {
      font-weight:600;
      margin-right:14px;
    }

    /* MAIN */
    main {
      max-width:1400px;     /* diperbesar */
      margin:28px auto;
      padding:0 16px;
    }

    /* GRID: form 30% â€“ table 70% */
    .grid {
      display:grid;
      grid-template-columns: 32% 68%;   /* diperlebar 30% */
      gap:26px;
    }

    /* CARD */
    .card {
      background:white;
      border-radius:12px;
      padding:20px;
      box-shadow:0 4px 12px rgba(0,0,0,0.12);
    }

    h2 {
      margin:0 0 15px;
      color:var(--accent);
      text-align:center;
      font-size:18px;
      font-weight:700;
    }

    /* INPUT FORM */
    label {
      font-weight:600;
      font-size:13px;
      margin:6px 0 3px;
      display:block;
    }

    input[type="text"],
    input[type="date"] {
      width:100%;
      padding:10px;
      border:1.4px solid #ccd7cc;
      border-radius:8px;
      font-size:14px;
    }

    input:disabled {
      background:#f3f3f3;
      cursor:not-allowed;
    }

    /* BUTTON */
    .row-btn { display:flex; gap:10px; margin-top:14px; }

    .btn {
      padding:10px 14px;
      border:none;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
      transition:0.2s;
      font-size:14px;
    }

    .btn-primary {
      background:linear-gradient(135deg,#0c5d27,#118b3f);
      color:white;
    }
    .btn-primary:hover { filter:brightness(1.08); }

    .btn-neutral {
      background:var(--grey);
      color:white;
    }
    .btn-neutral:disabled {
      background:var(--greyLight);
      color:#777;
      cursor:not-allowed;
    }

    /* TABLE WRAP */
    .table-wrap {
      max-height:650px;          /* diperpanjang */
      overflow-y:auto;
      border:1px solid #dce6dc;
      border-radius:10px;
    }

    table {
      width:100%;
      font-size:14px;
      border-collapse:collapse;
    }
    th, td {
      padding:10px;
      border-bottom:1px solid #e7efe7;
      vertical-align:top;
      text-align:left;
    }
    thead th {
      background:var(--accent);
      color:white;
      position:sticky;
      top:0;
      font-weight:700;
    }
    tbody tr:hover { background:#f8fcf8; }

    /* STATUS DOT */
    .dot {
      width:10px;
      height:10px;
      border-radius:3px;
      display:inline-block;
      margin-right:5px;
    }

    /* BUTTON EDIT DELETE */
    .action-btn {
      padding:6px 9px;
      border:none;
      border-radius:6px;
      font-size:13px;
      font-weight:600;
      cursor:pointer;
    }
    .edit { background:var(--warn); color:black; margin-right:6px; }
    .del { background:var(--danger); color:white; }
  </style>
</head>

<body onload="initKendaraanPage()">

  <!-- HEADER -->
  <header>
    <div><strong>ğŸš— PT ANISA JAYA UTAMA â€” BY ROY</strong></div>

    <div style="display:flex; align-items:center;">
      <span id="adminName">ğŸ‘¨â€ğŸ’¼ Admin</span>
      <nav>
        <a href="dashboard.html">ğŸ  Dashboard</a>
        <a href="user.html">ğŸ‘¤ User</a>
        <a href="login.html">ğŸ”’ Logout</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="grid">

      <!-- === FORM === -->
      <section class="card">
        <h2>ğŸ§¾ FORM KENDARAAN</h2>

        <label>ğŸš˜ PLAT NOMOR</label>
        <input id="plat" type="text" placeholder="CONTOH: B1234XYZ">

        <label>ğŸ“ LETAK / GARASI</label>
        <input id="letak" type="text" placeholder="CONTOH: JAKARTA">

        <label>ğŸ“‹ STNK</label>
        <input id="stnk" type="date">

        <label>ğŸ”§ KIR</label>
        <input id="kir" type="date">

        <label>ğŸ›  SERVIS TERAKHIR</label>
        <input id="servis" type="date">

        <label>ğŸ’° PAJAK 5 TAHUNAN</label>
        <input id="pajak5" type="date">

        <div class="row-btn">
          <button id="btnPrimary" class="btn btn-primary">â• Tambah</button>
          <button id="btnCancel" class="btn btn-neutral" disabled>âŒ Batal</button>
        </div>
      </section>

      <!-- === TABLE === -->
      <section class="card">
        <h2>ğŸ“‹ DAFTAR KENDARAAN</h2>

        <input id="searchInput" type="text"
          placeholder="ğŸ” CARI KENDARAAN (PLAT / LETAK)"
          style="padding:10px; width:100%; border-radius:8px; border:1.4px solid #ccd7cc; margin-bottom:12px;"
        >

        <div class="table-wrap">
          <table id="tblKendaraan">
            <thead>
              <tr>
                <th>ğŸš˜ PLAT</th>
                <th>ğŸ“ LETAK</th>
                <th>ğŸ“‹ STNK</th>
                <th>ğŸ”§ KIR</th>
                <th>ğŸ›  SERVIS</th>
                <th>ğŸ’° PAJAK 5 TH</th>
                <th>âš™ï¸ AKSI</th>
              </tr>
            </thead>
            <tbody>
              <tr><td colspan="7" align="center">Memuat data...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

    </div>
  </main>

  <script src="main.js?v=8.1"></script>

  <script>
    const $ = id => document.getElementById(id);

    /* ========== ADMIN NAME ========= */
    function showAdminName(){
      const u = getSession();
      if(u && u.nama){
        $("adminName").textContent = "ğŸ‘¨â€ğŸ’¼ " + u.nama.toUpperCase();
      }
    }

    /* ========== AUTO UPPERCASE ========== */
    $("plat").addEventListener("input", e=>{
      e.target.value = e.target.value.toUpperCase();
    });
    $("letak").addEventListener("input", e=>{
      e.target.value = e.target.value.toUpperCase();
    });

    /* ========== INIT PAGE ========== */
    async function initKendaraanPage(){
      showAdminName();
      $("searchInput").addEventListener("input", filter);
      await loadData();
    }

    /* ========== LOAD DATA ========== */
    let DATA = [];
    async function loadData(){
      const tb = document.querySelector("#tblKendaraan tbody");
      tb.innerHTML = `<tr><td colspan="7" align="center">Memuat data...</td></tr>`;
      const res = await api("getKendaraan");
      if(!res.success){
        tb.innerHTML = `<tr><td colspan="7" align="center">Gagal memuat data</td></tr>`;
        return;
      }
      DATA = res.data;
      render(DATA);
    }

    /* ========== RENDER TABLE ========== */
    function render(list){
      const tb = document.querySelector("#tblKendaraan tbody");

      tb.innerHTML = list.map(k => {
        const stnk = getStatusTanggal(k.STNK);
        const kir  = getStatusTanggal(k.KIR);
        const srv  = getStatusServis(k.ServisTerakhir);
        const pjk  = getStatusTanggal(k.pajak5tahun);

        return `
        <tr>
          <td><b>${k.Platnomor}</b></td>
          <td>${k.Letak}</td>

          <td><span class="dot" style="background:${stnk.color}"></span>${fmtDate(k.STNK)}<br><small>${stnk.text}</small></td>
          <td><span class="dot" style="background:${kir.color}"></span>${fmtDate(k.KIR)}<br><small>${kir.text}</small></td>
          <td><span class="dot" style="background:${srv.color}"></span>${fmtDate(k.ServisTerakhir)}<br><small>${srv.text}</small></td>
          <td><span class="dot" style="background:${pjk.color}"></span>${fmtDate(k.pajak5tahun)}<br><small>${pjk.text}</small></td>

          <td>
            <button class="action-btn edit" onclick="editData('${k.Platnomor}')">âœï¸ Edit</button>
            <button class="action-btn del" onclick="hapusData('${k.Platnomor}')">ğŸ—‘ Hapus</button>
          </td>
        </tr>`;
      }).join("");
    }

    /* ===== FILTER ===== */
    function filter(){
      const q = $("searchInput").value.toLowerCase();
      document.querySelectorAll("#tblKendaraan tbody tr").forEach(r=>{
        r.style.display = r.innerText.toLowerCase().includes(q) ? "" : "none";
      });
    }
  </script>

</body>
</html>
