<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Data Kendaraan - PT Anisa Jaya Utama</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
<style>
* { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
body {
  margin: 0;
  background: #f4f7ff;
  color: #222;
}
.container {
  padding: 90px 20px 20px;
  max-width: 1200px;
  margin: auto;
}
h2 {
  color: #14376b;
}
button {
  background: #1763c5;
  border: none;
  color: white;
  padding: 10px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  margin-bottom: 15px;
}
button:hover {
  background: #114d9d;
}
.table-wrapper {
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 3px 12px rgba(0,0,0,0.05);
  overflow-y: auto;
  max-height: 70vh;
}
table {
  width: 100%;
  border-collapse: collapse;
}
thead {
  background: #1763c5;
  color: #fff;
}
thead th {
  padding: 10px;
  text-align: left;
}
tbody td {
  padding: 8px 10px;
  border-bottom: 1px solid #eee;
}
.status-green { color: #27ae60; font-weight: 600; }
.status-red { color: #e74c3c; font-weight: 600; }
</style>
</head>
<body>
<div class="container">
  <h2>ðŸš˜ Data Kendaraan</h2>
  <button id="btnTambah">+ Tambah Kendaraan</button>

  <div class="table-wrapper">
    <table id="kendaraanTable">
      <thead>
        <tr>
          <th>Plat Nomor</th>
          <th>Letak</th>
          <th>STNK</th>
          <th>KIR</th>
          <th>Servis Terakhir</th>
          <th>Pajak 5 Tahunan</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwAH7TUpCMajOE3Mtuz0ELcsXVurKQkFz2e5vPVVf4IT4JPHhoErMvO9A-i0A4cGB4q/exec";

// === AMBIL DATA DARI DATABASE ===
async function getDataKendaraan() {
  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "text/plain;charset=utf-8" },
      body: JSON.stringify({ action: "getKendaraan" })
    });
    const data = await res.json();
    if (data.success && data.records) {
      renderTable(data.records);
    }
  } catch (e) {
    console.error("Gagal ambil data kendaraan:", e);
  }
}

// === RENDER KE TABEL ===
function renderTable(data) {
  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";
  data.forEach(item => {
    tbody.innerHTML += `
      <tr>
        <td>${item.plat || "-"}</td>
        <td>${item.lokasi || "-"}</td>
        <td class="${status(item.stnk)}">${format(item.stnk)}</td>
        <td class="${status(item.kir)}">${format(item.kir)}</td>
        <td class="${status(item.servis)}">${format(item.servis)}</td>
        <td class="${status(item.pajak)}">${format(item.pajak)}</td>
      </tr>
    `;
  });
}

// === STATUS (HIDUP / MATI) ===
function status(date) {
  const today = new Date();
  const d = new Date(date);
  return d >= today ? "status-green" : "status-red";
}

// === FORMAT TANGGAL ===
function format(dateStr) {
  const d = new Date(dateStr);
  return isNaN(d) ? "-" : d.toISOString().split("T")[0];
}

// === EVENT TAMBAH (sementara belum aktif) ===
document.getElementById("btnTambah").addEventListener("click", () => {
  alert("Form tambah kendaraan akan diaktifkan nanti (versi elegan popup).");
});

// === INIT ===
getDataKendaraan();
</script>
</body>
</html>
