<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kendaraan | PT ANISA JAYA UTAMA â€” BY ROY</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    body{font-family:'Poppins',sans-serif;background:#f6f9f6;margin:0;color:#123}
    header{background:#0c5d27;color:#fff;padding:14px 18px;display:flex;justify-content:space-between;align-items:center}
    header nav a{color:#fff;text-decoration:none;margin-left:16px}
    main{max-width:1400px;margin:28px auto;padding:0 16px}
    .grid{display:grid;grid-template-columns:360px 1fr;gap:24px}
    .card{background:#fff;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.08);padding:18px}
    h2{margin:0 0 12px;color:#0b4d1b}
    label{display:block;margin:10px 0 6px;font-weight:600}
    input[type="text"],input[type="date"]{width:100%;padding:9px 12px;border:1.4px solid #cdd9cd;border-radius:8px}
    .row-btn{display:flex;gap:10px;margin-top:14px}
    .btn{border:none;border-radius:8px;padding:10px 12px;font-weight:700;cursor:pointer}
    .btn-primary{background:#0c5d27;color:#fff}
    .btn-cancel{background:#e0e0e0;color:#333}
    .table-wrap{overflow:auto;border-radius:8px;border:1px solid #e6efe6;padding:6px;background:#fff}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid #eee;text-align:left}
    thead th{text-transform:uppercase;background:#0c5d27;color:#fff}
  </style>
</head>
<body onload="initKendaraan()">
  <header>
    <div><strong>ğŸš— PT ANISA JAYA UTAMA â€” BY ROY</strong></div>
    <nav>
      <a href="dashboard.html">ğŸ  Dashboard</a>
      <a href="user.html">ğŸ‘¤ User</a>
      <a href="#" onclick="logout()">ğŸ”’ Logout</a>
    </nav>
  </header>

  <main>
    <div class="grid">
      <section class="card">
        <h2>ğŸ§¾ FORM KENDARAAN</h2>
        <label>Plat Nomor</label><input id="plat" type="text" disabled />
        <label>Letak / Garasi</label><input id="letak" type="text" disabled />
        <label>STNK</label><input id="stnk" type="date" disabled />
        <label>KIR</label><input id="kir" type="date" disabled />
        <label>Servis Terakhir</label><input id="servis" type="date" disabled />
        <label>Pajak 5 Tahunan</label><input id="pajak5" type="date" disabled />
        <div class="row-btn">
          <button id="btnPrimary" class="btn btn-primary" onclick="toggleTambah()">â• Tambah</button>
          <button id="btnCancel" class="btn btn-cancel" onclick="batalEdit()" disabled>âŒ Batal</button>
        </div>
      </section>

      <section class="card">
        <h2>ğŸ“‹ DAFTAR KENDARAAN</h2>
        <div style="margin-bottom:12px;display:flex;gap:8px;align-items:center">
          <input id="searchInput" type="text" placeholder="ğŸ” Cari kendaraan (Plat / Letak)" style="flex:1;padding:9px;border:1.4px solid #cdd9cd;border-radius:8px">
          <button id="clearSearch" style="display:none;padding:8px;border-radius:6px;background:#c0392b;color:white;border:none">âŒ</button>
        </div>
        <div class="table-wrap">
          <table id="tblKendaraan">
            <thead>
              <tr>
                <th>Plat Nomor</th><th>Letak</th><th>STNK</th><th>KIR</th><th>Servis Terakhir</th><th>Pajak 5 Tahun</th><th>Aksi</th>
              </tr>
            </thead>
            <tbody><tr><td colspan="7" align="center">Memuat data...</td></tr></tbody>
          </table>
        </div>
      </section>
    </div>
  </main>

  <script src="main.js?v=7.5"></script>
  <script>
    // Admin check (preserve main.js behavior)
    const u = getSession();
    if (!u) location.href = "login.html";
    if (u.role !== "admin") {
      toast("ğŸš« Hanya admin yang bisa mengakses halaman ini!");
      setTimeout(()=>location.href="dashboard.html",1500);
    }

    // Small helpers to reuse functions in main.js without modifying it heavily
    function toggleTambah(){
      const btn = document.getElementById('btnPrimary');
      if (btn.dataset.mode === 'add') { // currently add -> perform save
        simpanKendaraan();
      } else {
        // enable form fields for adding
        ["plat","letak","stnk","kir","servis","pajak5"].forEach(id=>document.getElementById(id).removeAttribute('disabled'));
        btn.textContent = 'ğŸ’¾ Simpan';
        btn.dataset.mode = 'add';
        document.getElementById('btnCancel').disabled = false;
      }
    }
    function batalEdit(){
      ["plat","letak","stnk","kir","servis","pajak5"].forEach(id=>{const el=document.getElementById(id);el.value='';el.setAttribute('disabled','disabled')});
      const btn = document.getElementById('btnPrimary');
      btn.textContent = 'â• Tambah'; btn.dataset.mode = '';
      document.getElementById('btnCancel').disabled = true;
    }

    // Wire up clear search & filter using initSearch from main.js
    const s = document.getElementById('searchInput');
    const clearBtn = document.getElementById('clearSearch');
    s.addEventListener('input', ()=>{
      clearBtn.style.display = s.value ? 'inline-block' : 'none';
      try { initSearch(); } catch(e) {}
    });
    clearBtn.addEventListener('click', ()=>{ s.value=''; s.dispatchEvent(new Event('input')); });

    // When page loads, main.js initKendaraan() will render table and call initSearch()
  </script>
</body>
</html>
