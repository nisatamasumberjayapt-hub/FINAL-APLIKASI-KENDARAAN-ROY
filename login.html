<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login - PT ANISA JAYA UTAMA</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
/* ===================== GLOBAL ===================== */
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif;}
body{
  background:linear-gradient(180deg,#f1f6ff,#dbe7ff);
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* ===================== LOGIN CARD ===================== */
.card{
  background:rgba(255,255,255,0.9);
  width:350px;
  padding:30px 28px;
  border-radius:18px;
  text-align:center;
  box-shadow:0 10px 25px rgba(0,0,0,0.15);
  animation:fadeIn .4s ease;
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(15px);}
  to{opacity:1;transform:translateY(0);}
}

.card h2{
  font-size:22px;
  margin-bottom:8px;
  letter-spacing:1px;
}
.card h2::before{
  content:"‚ù§Ô∏è";
  margin-right:6px;
  animation:beat 1.2s infinite;
}
@keyframes beat{
  50%{transform:scale(1.25);}
}

.subtitle{
  font-size:14px;
  color:#555;
  margin-bottom:25px;
}

.input-group{position:relative;margin-bottom:16px;}
.input-group input{
  width:100%;
  padding:12px 14px;
  border:1.4px solid #ccc;
  border-radius:10px;
  font-size:14px;
}
.input-group input:focus{
  border-color:#3085fe;
  box-shadow:0 0 6px rgba(48,133,254,0.4);
}

.toggle-pass{
  position:absolute;
  right:10px;top:10px;
  cursor:pointer;
  font-size:18px;
}

/* ===================== LOGIN BUTTON ===================== */
#btnLogin{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#16792c;
  color:#fff;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  box-shadow:0 4px 10px rgba(22,121,44,0.4);
  transition:.2s;
}
#btnLogin:hover{background:#0f5c20;}

.card a{color:#16792c;font-weight:600;text-decoration:none;}
.card a:hover{text-decoration:underline;}

/* ===================== STABLE LOADING ANIMATION ===================== */
#loading{
  position:fixed;
  inset:0;
  background:linear-gradient(180deg,#ffffff,#f1f6ff);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999;
}

.load-wrap{
  text-align:center;
  animation:fadeIn .5s ease;
}

#monkey{
  width:250px;
  animation:float 3s infinite ease-in-out;
}

@keyframes float{
  0%,100%{transform:translateY(0);}
  50%{transform:translateY(-10px);}
}

#motor{
  width:140px;
  margin-top:-15px;
  animation:drive 2.4s ease forwards;
}
@keyframes drive{
  0%{transform:translateX(-40px);}
  100%{transform:translateX(40px);}
}

.load-text{
  margin-top:8px;
  font-weight:600;
  color:#0053b8;
  animation:fadeBlink 1.6s infinite;
}
@keyframes fadeBlink{
  0%,100%{opacity:1;}
  50%{opacity:0.4;}
}
</style>
</head>

<body>

<!-- ================= LOGIN FORM ================= -->
<div class="card" id="formCard">
  <h2>PT ANISA JAYA UTAMA</h2>
  <div class="subtitle">Login Pengguna</div>

  <div class="input-group">
    <input type="text" id="username" placeholder="Username">
  </div>

  <div class="input-group">
    <input type="password" id="password" placeholder="Password">
    <span class="toggle-pass" id="togglePass">üëÅÔ∏è</span>
  </div>

  <button id="btnLogin">Masuk</button>

  <p style="margin-top:10px;">Belum punya akun?
    <a href="register.html">Daftar di sini</a>
  </p>
</div>

<!-- ================= LOADING STABIL ================= -->
<div id="loading">
  <div class="load-wrap">
    <img id="monkey" src="assets/monyet_mikir.png" alt="monyet">
    <div>
      <img id="motor" src="assets/monyet_motor.png">
    </div>
    <div class="load-text">Sedang masuk...</div>
  </div>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbwAH7TUpCMajOE3Mtuz0ELcsXVurKQkFz2e5vPVVf4IT4JPHhoErMvO9A-i0A4cGB4q/exec";

function setSession(u){
  localStorage.setItem("aj_user",JSON.stringify(u));
}

async function api(action, payload={}){
  try{
    const res=await fetch(API_URL,{
      method:"POST",
      headers:{ "Content-Type":"text/plain;charset=utf-8" },
      body:JSON.stringify({action,...payload})
    });
    return await res.json();
  }catch(e){
    return{success:false};
  }
}

/* SHOW/HIDE LOADING */
function showLoading(){
  document.getElementById("formCard").style.display="none";
  document.getElementById("loading").style.display="flex";
}
function hideLoading(){
  document.getElementById("loading").style.display="none";
  document.getElementById("formCard").style.display="block";
}

/* PASSWORD TOGGLE */
document.getElementById("togglePass").onclick=()=>{
  const p=document.getElementById("password");
  if(p.type==="password"){ p.type="text"; togglePass.textContent="üôà"; }
  else{ p.type="password"; togglePass.textContent="üëÅÔ∏è"; }
};

/* LOGIN HANDLER */
document.getElementById("btnLogin").onclick=async()=>{
  const user=document.getElementById("username").value.trim();
  const pass=document.getElementById("password").value.trim();
  if(!user||!pass) return alert("Isi username dan password!");

  showLoading();

  const res=await api("login",{username:user,password:pass});

  if(res.success){
    // beri setiap user emoji random (stabil)
    const emojis=["üêµ","ü¶ä","üêØ","üêº","üê®","üê∏","üêß","üê§","üê∞"];
    res.user.emoji = emojis[Math.floor(Math.random()*emojis.length)];

    setSession(res.user);
    setTimeout(()=>location.href="dashboard.html", 1200);
  }else{
    alert("Username atau password salah!");
    hideLoading();
  }
};
</script>

</body>
</html>
