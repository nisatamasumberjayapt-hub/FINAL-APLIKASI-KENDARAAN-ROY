<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Login - PT ANISA JAYA UTAMA</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
<style>
/* === LOGIN CARD (TIDAK DIUBAH) === */
*{box-sizing:border-box;font-family:'Poppins',sans-serif}
body{background:linear-gradient(180deg,#f1f6ff 0%,#dbe7ff 100%);display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
.card{background:rgba(255,255,255,0.9);border-radius:18px;box-shadow:0 8px 25px rgba(0,0,0,0.1),0 0 15px rgba(0,100,255,0.1);padding:35px 30px;width:min(90vw,370px);text-align:center;position:relative;backdrop-filter:blur(10px);animation:fadeIn .6s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}
h2{font-size:22px;margin-bottom:6px;color:#1b1b1b;text-transform:uppercase;font-weight:600;letter-spacing:1px}
h2::before{content:"‚ù§Ô∏è";display:inline-block;animation:beat 1.3s infinite;margin-right:6px}
@keyframes beat{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}
.subtitle{color:#444;margin-bottom:25px}
.input-group{position:relative;margin-bottom:15px}
input{width:100%;padding:12px 14px;border:1px solid #ccc;border-radius:10px;outline:none;font-size:14px;transition:.2s}
input:focus{border-color:#2b7cff;box-shadow:0 0 8px rgba(43,124,255,0.3)}
.toggle-pass{position:absolute;right:10px;top:9px;cursor:pointer;font-size:18px}
#btnLogin{width:100%;padding:12px;border:none;border-radius:10px;background:#1b6e2a;color:#fff;font-weight:bold;cursor:pointer;font-size:15px;transition:.25s;box-shadow:0 3px 8px rgba(27,110,42,0.3)}
#btnLogin:hover{background:#13561f}
a{color:#1b6e2a;text-decoration:none;font-weight:500}
a:hover{text-decoration:underline}

/* === LOADING OVERLAY === */
#loadingOverlay{position:fixed;inset:0;background:linear-gradient(180deg,#fff 0%,#f3f7ff 100%);display:none;align-items:center;justify-content:center;z-index:999;overflow:hidden}
.scene-wrap{width:100%;max-width:1100px;height:70vh;display:flex;align-items:center;justify-content:center;position:relative}

/* Monyet besar */
#monkeyBig{width:300px;max-width:40vw;animation:breath 3s ease-in-out infinite;z-index:40;position:relative;top:-20px;}
@keyframes breath{0%,100%{transform:translateY(0)scale(1)}50%{transform:translateY(-8px)scale(1.03)}}

/* ==== Teks di atas kepala monyet ==== */
.loading-text{
  position:absolute;
  top:calc(50% - 140px);
  text-align:center;
  color:#003a8c;
  font-size:18px;
  line-height:1.3;
  z-index:41;
}

/* Jalan dan motor */
.road{
  position:absolute;
  bottom:calc(22vh - 25px);
  left:6%;right:6%;
  height:8px;
  background:linear-gradient(90deg,#f1f3f8,#e9eef8);
  border-radius:6px;
  box-shadow:inset 0 -2px 6px rgba(0,0,0,0.03);
}

.motor-group{
  position:absolute;
  bottom:calc(22vh - 40px);
  left:8%;
  display:flex;align-items:center;gap:8px;z-index:35;
}
.motor-group img{width:90px;filter:drop-shadow(0 5px 8px rgba(0,0,0,0.12))}
.motor-label{font-weight:600;color:#004aad;font-size:15px;position:relative;top:-4px}

/* Motor gerak */
.driving{animation:driveClean 4.5s ease-in-out forwards}
@keyframes driveClean{
  0%{transform:translateX(0)}
  45%{transform:translateX(26vw)}
  100%{transform:translateX(50vw)}
}

/* Fade-out motor kalau sukses */
.fade-out{animation:fadeOutMotor 1.2s ease forwards}
@keyframes fadeOutMotor{0%{opacity:1;transform:translateX(50vw)}100%{opacity:0;transform:translateX(55vw)}}

/* Gagal muter */
.spin-fail{animation:spinFail 1s linear infinite}
@keyframes spinFail{0%{transform:translateX(50vw)rotate(0)}100%{transform:translateX(50vw)rotate(360deg)}}

/* Asap */
.smoke{position:absolute;bottom:calc(22vh - 15px);left:calc(50vw + 20px);width:16px;height:16px;border-radius:50%;background:rgba(120,120,120,0.25);filter:blur(2px);opacity:0;z-index:36}
.smoke.s1{animation:smoke1 1.3s ease forwards}
.smoke.s2{animation:smoke2 1.6s ease forwards}
@keyframes smoke1{0%{opacity:0;transform:translateY(0)scale(.6)}30%{opacity:1}100%{opacity:0;transform:translateY(-45px)scale(1.2)}}
@keyframes smoke2{0%{opacity:0;transform:translateY(0)scale(.7)}20%{opacity:.9}100%{opacity:0;transform:translateY(-55px)scale(1.4)}}

/* Fade overlay */
.overlay-fade{animation:fadeOut .9s ease forwards}
@keyframes fadeOut{from{opacity:1}to{opacity:0}}
</style>
</head>
<body>

<!-- LOGIN CARD -->
<div class="card" id="loginCard">
  <h2>PT ANISA JAYA UTAMA</h2>
  <div class="subtitle">Login Pengguna</div>
  <div class="input-group"><input type="text" id="username" placeholder="Username"></div>
  <div class="input-group"><input type="password" id="password" placeholder="Password"><span class="toggle-pass" id="togglePass">üëÅÔ∏è</span></div>
  <button id="btnLogin">Masuk</button>
  <p style="margin-top:10px;">Belum punya akun? <a href="register.html">Daftar di sini</a></p>
</div>

<!-- OVERLAY -->
<div id="loadingOverlay">
  <div class="scene-wrap">
    <div class="loading-text" id="loadingText">üêµ Monyet lagi mikir...<br>Apakah kamu orang yang tepat...?</div>
    <img id="monkeyBig" src="assets/monyet_mikir.png" alt="monyet mikir">
    <div class="road"></div>
    <div class="motor-group" id="motorGroup"><img src="assets/monyet_motor.png"><div class="motor-label">kamu otw üëâ</div></div>
    <div class="smoke" id="smoke1"></div><div class="smoke" id="smoke2"></div>
  </div>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbwAH7TUpCMajOE3Mtuz0ELcsXVurKQkFz2e5vPVVf4IT4JPHhoErMvO9A-i0A4cGB4q/exec";
const btn=document.getElementById('btnLogin'),toggle=document.getElementById('togglePass'),pass=document.getElementById('password'),card=document.getElementById('loginCard');
const overlay=document.getElementById('loadingOverlay'),monkeyBig=document.getElementById('monkeyBig'),loadingText=document.getElementById('loadingText');
const motorGroup=document.getElementById('motorGroup'),smoke1=document.getElementById('smoke1'),smoke2=document.getElementById('smoke2');

toggle.addEventListener('click',()=>{pass.type=pass.type==='password'?'text':'password';toggle.textContent=pass.type==='password'?'üëÅÔ∏è':'üôà';});
function setSession(u){try{localStorage.setItem('aj_user',JSON.stringify(u));}catch(e){}}
async function api(action,payload={}){try{const r=await fetch(API_URL,{method:'POST',headers:{'Content-Type':'text/plain;charset=utf-8'},body:JSON.stringify({action,...payload})});return await r.json()}catch{return{success:false}}}

function showOverlay(){
  card.style.display='none';overlay.style.display='flex';overlay.classList.remove('overlay-fade');
  monkeyBig.src='assets/monyet_mikir.png';loadingText.innerHTML='üêµ Monyet lagi mikir...<br>Apakah kamu orang yang tepat...?';
  motorGroup.classList.remove('spin-fail','fade-out');motorGroup.style.transform='translateX(0)';smoke1.className='smoke';smoke2.className='smoke';
  motorGroup.classList.add('driving');
}

function handleSuccess(user){
  monkeyBig.src='assets/monyet_senang.png';loadingText.innerHTML='‚úÖ Monyet yakin kamu orang yang benar!';
  motorGroup.classList.remove('driving');motorGroup.classList.add('fade-out');
  setTimeout(()=>overlay.classList.add('overlay-fade'),1200);
  setTimeout(()=>{setSession(user);window.location.href='dashboard.html';},1700);
}

function handleFail(){
  monkeyBig.src='assets/monyet_salah.png';loadingText.innerHTML='<b style="display:block;font-size:22px;color:#3a2a00">KAMU BUKAN ORANG YANG TEPAT</b>üôà Monyet berhenti mikir... salah orang!';
  motorGroup.classList.remove('driving');motorGroup.classList.add('spin-fail');
  smoke1.classList.add('s1');smoke2.classList.add('s2');
  setTimeout(()=>{smoke1.classList.remove('s1');smoke2.classList.remove('s2');motorGroup.classList.remove('spin-fail');overlay.style.display='none';card.style.display='block';},2600);
}

btn.addEventListener('click',async()=>{
  const username=document.getElementById('username').value.trim(),password=pass.value.trim();
  if(!username||!password)return alert('Isi username dan password!');
  showOverlay();
  try{
    const res=await api('login',{username,password});
    if(res.success)setTimeout(()=>handleSuccess(res.user),1000);
    else setTimeout(()=>handleFail(),1400);
  }catch{
    setTimeout(()=>{monkeyBig.src='assets/monyet_salah.png';loadingText.innerHTML='‚ö†Ô∏è Server error, coba lagi nanti!';setTimeout(()=>{overlay.style.display='none';card.style.display='block';},1400);},700);
  }
});
</script>
</body>
</html>
