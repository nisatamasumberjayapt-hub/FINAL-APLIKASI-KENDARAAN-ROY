<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Login - PT ANISA JAYA UTAMA</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
<style>
/* === KARTU LOGIN (TIDAK DIUBAH - PERTAHANKAN TAMPILAN ASLI) === */
* { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
body {
  background: linear-gradient(180deg, #f1f6ff 0%, #dbe7ff 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
  margin: 0;
}

/* === CARD LOGIN (pastikan ini identik dengan versi final yang kamu punya) === */
.card {
  background: rgba(255,255,255,0.9);
  border-radius: 18px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.1), 0 0 15px rgba(0,100,255,0.1);
  padding: 35px 30px;
  width: min(90vw, 370px);
  text-align: center;
  position: relative;
  backdrop-filter: blur(10px);
  animation: fadeIn 0.6s ease;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(15px); }
  to { opacity: 1; transform: translateY(0); }
}

h2 {
  font-size: 22px;
  margin-bottom: 6px;
  color: #1b1b1b;
  text-transform: uppercase;
  font-weight: 600;
  letter-spacing: 1px;
}
h2::before {
  content: "‚ù§Ô∏è";
  display: inline-block;
  animation: beat 1.3s infinite;
  margin-right: 6px;
}
@keyframes beat {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.2); }
}

.subtitle { color: #444; margin-bottom: 25px; }

.input-group { position: relative; margin-bottom: 15px; }
input {
  width: 100%;
  padding: 12px 14px;
  border: 1px solid #ccc;
  border-radius: 10px;
  outline: none;
  font-size: 14px;
  transition: 0.2s;
}
input:focus {
  border-color: #2b7cff;
  box-shadow: 0 0 8px rgba(43,124,255,0.3);
}
.toggle-pass {
  position: absolute;
  right: 10px;
  top: 9px;
  cursor: pointer;
  font-size: 18px;
}

#btnLogin {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 10px;
  background: #1b6e2a;
  color: white;
  font-weight: bold;
  cursor: pointer;
  font-size: 15px;
  transition: 0.25s;
  box-shadow: 0 3px 8px rgba(27,110,42,0.3);
}
#btnLogin:hover { background: #13561f; }
a { color: #1b6e2a; text-decoration: none; font-weight: 500; }
a:hover { text-decoration: underline; }

/* === LOADING OVERLAY (ANIMASI) ===
   Overlay ini berada di atas seluruh konten dan hanya muncul saat login diproses.
   Semua style berikut hanya untuk animasi ‚Äî card login TETAP tidak berubah. */
#loadingOverlay {
  position: fixed;
  inset: 0;
  background: linear-gradient(180deg,#ffffff 0%,#f1f6ff 100%);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 999;
  overflow: hidden;
  pointer-events: none; /* biar form tidak bisa di-klik saat overlay tampil */
}

/* Scene container (mengatur area animasi) */
.scene-wrap {
  width: 100%;
  max-width: 1100px;
  height: 70vh;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

/* BIG MONKEY (di tengah, agak naik) */
#monkeyBig {
  width: 300px;
  max-width: 40vw;
  animation: monkeyBreath 3s ease-in-out infinite;
  z-index: 40;
  pointer-events: none;
}
@keyframes monkeyBreath {
  0% { transform: translateY(0) scale(1); }
  50% { transform: translateY(-8px) scale(1.03); }
  100% { transform: translateY(0) scale(1); }
}

/* TEXT bawah monyet (tetap di bawah monyet besar) */
.loading-text {
  position: absolute;
  top: 48%;
  transform: translateY(20px);
  text-align: center;
  color: #003a8c;
  font-size: 18px;
  line-height: 1.3;
  z-index: 41;
  pointer-events: none;
}

/* ROAD (garis) */
.road {
  position: absolute;
  bottom: 22vh;
  left: 6%;
  right: 6%;
  height: 8px;
  background: linear-gradient(90deg,#f1f3f8,#e9eef8);
  border-radius: 6px;
  box-shadow: inset 0 -2px 6px rgba(0,0,0,0.03);
  z-index: 20;
  pointer-events: none;
}

/* MOTOR GROUP (gambar kecil + teks 'kamu otw') */
.motor-group {
  position: absolute;
  bottom: calc(22vh - 18px);
  left: 8%;
  display: flex;
  align-items: center;
  gap: 8px;
  z-index: 35;
}
.motor-group img {
  width: 95px;
  height: auto;
  filter: drop-shadow(0 6px 8px rgba(0,0,0,0.12));
}
.motor-label {
  font-weight: 600;
  color: #004aad;
  font-size: 15px;
  pointer-events: none;
}

/* PORTAL GEAR ‚Äî lebih di-angkat (di atas jalan), bentuk swirl/gear */
.portal {
  position: absolute;
  bottom: calc(22vh + 38px);
  right: 8%;
  width: 170px;
  height: 170px;
  border-radius: 50%;
  /* conic + gradient untuk efek gear swirl */
  background:
    radial-gradient(circle at 50% 45%, rgba(173,216,255,0.9), rgba(173,216,255,0.65)),
    conic-gradient(from 0deg, rgba(110,0,255,0.95) 0deg, rgba(120,40,255,0.85) 60deg, rgba(60,0,200,0.95) 120deg,
                                    rgba(110,0,255,0.95) 180deg, rgba(120,40,255,0.85) 240deg, rgba(60,0,200,0.95) 300deg, rgba(110,0,255,0.95) 360deg);
  filter: blur(0.4px);
  box-shadow: 0 0 30px rgba(110,0,255,0.35), inset 0 0 30px rgba(255,255,255,0.25);
  z-index: 30;
  transform-origin: center;
  animation: gearSpin 5s linear infinite, portalPulse 2.6s ease-in-out infinite;
  pointer-events: none;
}
@keyframes gearSpin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
@keyframes portalPulse {
  0%,100% { box-shadow: 0 0 20px rgba(120,30,255,0.35), inset 0 0 18px rgba(255,255,255,0.2); }
  50% { box-shadow: 0 0 45px rgba(150,60,255,0.5), inset 0 0 28px rgba(255,255,255,0.3); }
}

/* DRIVE two-phase: pelan lalu ngebut (total 4.5s default) */
.driving {
  animation: driveTwoPhase var(--drive-time, 4.5s) ease-in-out forwards;
  transform-origin: left center;
}
@keyframes driveTwoPhase {
  0%   { transform: translateX(0) }
  45%  { transform: translateX(26vw) }  /* pelan di fase awal */
  100% { transform: translateX(62vw) }  /* ngebut di fase akhir */
}

/* Enter portal: shrink + fade */
.enter-portal {
  animation: enterPortal 1.2s ease forwards;
}
@keyframes enterPortal {
  0% { transform: translateX(62vw) scale(1); opacity: 1; }
  100% { transform: translateX(66vw) scale(.25); opacity: 0; }
}

/* FAIL: spin in place + smoke */
.spin-fail {
  animation: spinFail 1s linear infinite;
}
@keyframes spinFail {
  0% { transform: translateX(62vw) rotate(0deg); }
  100% { transform: translateX(62vw) rotate(360deg); }
}

/* Smoke */
.smoke {
  position: absolute;
  bottom: calc(22vh + 8px);
  left: calc(62vw + 20px);
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: rgba(120,120,120,0.25);
  filter: blur(2px);
  opacity: 0;
  z-index: 36;
  pointer-events: none;
}
.smoke.s1 { animation: smoke1 1.3s ease forwards; }
.smoke.s2 { animation: smoke2 1.6s ease forwards; }
@keyframes smoke1 {
  0% { opacity: 0; transform: translateY(0) scale(.6); }
  30% { opacity: 1; }
  100% { opacity: 0; transform: translateY(-45px) scale(1.2); }
}
@keyframes smoke2 {
  0% { opacity: 0; transform: translateY(0) scale(.7); }
  20% { opacity: .9; }
  100% { opacity: 0; transform: translateY(-55px) scale(1.4); }
}

/* Fade overlay class */
.overlay-fade { animation: overlayFade 0.9s ease forwards; }
@keyframes overlayFade { 0% { opacity: 1; } 100% { opacity: 0; } }

/* Responsive tweaks */
@media (max-width: 600px) {
  #monkeyBig { width: 220px; }
  .portal { width: 130px; height: 130px; bottom: calc(22vh + 20px); }
  .motor-group img { width: 78px; }
  .loading-text { font-size: 15px; }
}
</style>
</head>
<body>

<!-- === FORM LOGIN (TETAP PERSIS) === -->
<div class="card" id="loginCard">
  <h2>PT ANISA JAYA UTAMA</h2>
  <div class="subtitle">Login Pengguna</div>

  <div class="input-group">
    <input type="text" id="username" placeholder="Username" />
  </div>
  <div class="input-group">
    <input type="password" id="password" placeholder="Password" />
    <span class="toggle-pass" id="togglePass">üëÅÔ∏è</span>
  </div>

  <button id="btnLogin">Masuk</button>
  <p style="margin-top:10px;">Belum punya akun? <a href="register.html">Daftar di sini</a></p>
</div>

<!-- === LOADING OVERLAY (TAMBAHAN) === -->
<div id="loadingOverlay" aria-hidden="true">
  <div class="scene-wrap" id="sceneWrap">
    <!-- portal gear (muter terus) -->
    <div class="portal" id="portal"></div>

    <!-- big monkey -->
    <img id="monkeyBig" src="assets/monyet_mikir.png" alt="monyet mikir" />

    <!-- text di bawah monyet -->
    <div class="loading-text" id="loadingText">üêµ Monyet lagi mikir...<br>Apakah kamu orang yang tepat...?</div>

    <!-- road -->
    <div class="road" aria-hidden="true"></div>

    <!-- motor kecil (mulai dari kiri, tidak di paling pinggir agar natural) -->
    <div class="motor-group" id="motorGroup" aria-hidden="true">
      <img id="motorImg" src="assets/monyet_motor.png" alt="monyet naik motor" />
      <div class="motor-label" id="motorLabel">kamu otw üëâ</div>
    </div>

    <!-- smoke placeholders -->
    <div class="smoke" id="smoke1"></div>
    <div class="smoke" id="smoke2"></div>
  </div>
</div>

<script>
/* ====== JS: integrasi loading animation + login API call ====== */
const API_URL = "https://script.google.com/macros/s/AKfycbwAH7TUpCMajOE3Mtuz0ELcsXVurKQkFz2e5vPVVf4IT4JPHhoErMvO9A-i0A4cGB4q/exec";

const btn = document.getElementById('btnLogin');
const toggle = document.getElementById('togglePass');
const pass = document.getElementById('password');
const card = document.getElementById('loginCard');

const overlay = document.getElementById('loadingOverlay');
const sceneWrap = document.getElementById('sceneWrap');
const monkeyBig = document.getElementById('monkeyBig');
const loadingText = document.getElementById('loadingText');
const motorGroup = document.getElementById('motorGroup');
const motorImg = document.getElementById('motorImg');
const smoke1 = document.getElementById('smoke1');
const smoke2 = document.getElementById('smoke2');
const portal = document.getElementById('portal');

toggle.addEventListener('click', () => {
  if (pass.type === 'password') {
    pass.type = 'text';
    toggle.textContent = 'üôà';
  } else {
    pass.type = 'password';
    toggle.textContent = 'üëÅÔ∏è';
  }
});

function setSession(u){ try{ localStorage.setItem('aj_user', JSON.stringify(u)); }catch(e){} }

async function api(action, payload = {}) {
  try {
    const res = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body: JSON.stringify({ action, ...payload }),
    });
    return await res.json();
  } catch (err) {
    return { success: false };
  }
}

/* Show overlay and start drive animation */
function showOverlay() {
  // hide form
  card.style.display = 'none';
  // show overlay
  overlay.style.display = 'flex';
  overlay.classList.remove('overlay-fade');

  // reset states
  monkeyBig.src = 'assets/monyet_mikir.png';
  loadingText.innerHTML = 'üêµ Monyet lagi mikir...<br>Apakah kamu orang yang tepat...?';
  motorGroup.classList.remove('driving','enter-portal','spin-fail');
  motorGroup.style.transform = 'translateX(0)';
  smoke1.className = 'smoke';
  smoke2.className = 'smoke';
  // set CSS variable for duration if needed (default 4.5s)
  motorGroup.style.setProperty('--drive-time','4.5s');

  // small delay so overlay renders, then start driving (two phase)
  setTimeout(()=> {
    motorGroup.classList.add('driving');
  }, 120);
}

/* Success sequence: portal reaction + enter */
function handleSuccess(user) {
  // big monkey happy
  monkeyBig.src = 'assets/monyet_senang.png';
  loadingText.innerHTML = '‚úÖ Monyet yakin kamu orang yang benar!';

  // accelerate into portal (remove driving, add enter)
  motorGroup.classList.remove('driving','spin-fail');
  // give a tiny delay so animation change is visible
  setTimeout(()=> {
    motorGroup.classList.add('enter-portal');
  }, 140);

  // make portal "reactive" - quick brighter pulse (via inline style)
  portal.style.transition = 'box-shadow .35s ease, transform .35s ease';
  portal.style.boxShadow = '0 0 60px rgba(160,60,255,0.75), inset 0 0 35px rgba(255,255,255,0.4)';
  portal.style.transform = 'scale(1.06)';

  // fade overlay then redirect
  setTimeout(()=> {
    overlay.classList.add('overlay-fade');
  }, 1100);

  setTimeout(()=> {
    try{ setSession(user); }catch(e){}
    window.location.href = 'dashboard.html';
  }, 1500);
}

/* Failure sequence: spin in place, smoke, then restore form */
function handleFail() {
  monkeyBig.src = 'assets/monyet_salah.png';
  loadingText.innerHTML = '<b style="display:block;font-size:22px;color:#3a2a00">KAMU BUKAN ORANG YANG TEPAT</b>üôà Monyet berhenti mikir... salah orang!';
  motorGroup.classList.remove('driving');
  // spin at the current place to mimic confused
  motorGroup.classList.add('spin-fail');

  // smoke animations
  smoke1.classList.add('s1');
  smoke2.classList.add('s2');

  // after smoke and spin, hide overlay and return to form
  setTimeout(()=> {
    smoke1.classList.remove('s1');
    smoke2.classList.remove('s2');
    motorGroup.classList.remove('spin-fail','driving');
    overlay.style.display = 'none';
    card.style.display = 'block';
  }, 2500);
}

/* Main handler for login button */
btn.addEventListener('click', async () => {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  if (!username || !password) return alert('Isi username dan password!');

  showOverlay();

  try {
    const res = await api('login', { username, password });
    // timing: wait a little so motor can travel some distance (feel)
    if (res && res.success) {
      // after a short interval (so motor has begun moving), trigger success sequence
      setTimeout(()=> handleSuccess(res.user), 1000); // adjust to sync with driveTwoPhase
    } else {
      // on fail, wait timelapse then fail animation
      setTimeout(()=> handleFail(), 1400);
    }
  } catch (e) {
    // network error fallback
    setTimeout(()=> {
      monkeyBig.src = 'assets/monyet_salah.png';
      loadingText.innerHTML = '‚ö†Ô∏è Server error, coba lagi nanti!';
      setTimeout(()=> { overlay.style.display = 'none'; card.style.display = 'block'; }, 1400);
    }, 700);
  }
});
</script>
</body>
</html>
