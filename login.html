<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Login - PT ANISA JAYA UTAMA</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

<style>
/* ===== DASAR LOGIN ===== */
* { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
body {
  background: linear-gradient(180deg, #f1f6ff 0%, #dbe7ff 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
  margin: 0;
}

/* ==== CARD LOGIN ==== */
.card {
  background: rgba(255,255,255,0.9);
  border-radius: 18px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.1), 0 0 15px rgba(0,100,255,0.1);
  padding: 35px 30px;
  width: min(90vw, 370px);
  text-align: center;
  backdrop-filter: blur(10px);
  animation: fadeIn 0.6s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(15px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ==== TITLE LOVE ==== */
.title-love {
  font-size: 22px;
  font-weight: 600;
  text-transform: uppercase;
  position: relative;
  padding-left: 32px;
  letter-spacing: 1px;
}
.title-love::before {
  content: "‚ù§Ô∏è";
  position: absolute;
  left: 0;
  top: -2px;
  font-size: 20px;
  animation: beatLove 1.3s infinite;
}
@keyframes beatLove {
  0%,100% { transform: scale(1); }
  50% { transform: scale(1.25); }
}

.subtitle { color: #444; margin-bottom: 25px; }

/* ==== INPUT ==== */
.input-group { position: relative; margin-bottom: 15px; }
input {
  width: 100%;
  padding: 12px 14px;
  border: 1px solid #ccc;
  border-radius: 10px;
  outline: none;
  transition: 0.2s;
}
input:focus {
  border-color: #2b7cff;
  box-shadow: 0 0 8px rgba(43,124,255,0.3);
}

.toggle-pass {
  position: absolute;
  right: 10px;
  top: 9px;
  cursor: pointer;
  font-size: 18px;
}

#btnLogin {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 10px;
  background: #1b6e2a;
  color: white;
  font-weight: bold;
  cursor: pointer;
  transition: 0.25s;
  box-shadow: 0 3px 8px rgba(27,110,42,0.3);
}
#btnLogin:hover { background: #13561f; }

/* ===== LOADING ANIMATION ===== */
#loadingOverlay {
  position: fixed;
  inset: 0;
  background: linear-gradient(180deg,#ffffff 0%,#f1f6ff 100%);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 999;
}

.scene-wrap {
  width: 100%;
  max-width: 1100px;
  height: 70vh;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* MONYET BESAR ‚Äì penjaga jalan */
#monkeyBig {
  width: 310px;
  position: absolute;
  right: 11vw;
  top: 20vh;
  z-index: 30;
  animation: monkeyBreath 3s ease-in-out infinite;
}
@keyframes monkeyBreath {
  0% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
  100% { transform: translateY(0); }
}

/* JALAN */
.road {
  position: absolute;
  bottom: 22vh;
  left: 18%;
  right: 18%;
  height: 8px;
  background: #eef3fb;
  border-radius: 6px;
  box-shadow: inset 0 -2px 6px rgba(0,0,0,0.04);
}

/* MOTOR */
.motor-group {
  position: absolute;
  bottom: calc(22vh - 15px);
  left: 18%;
  display: flex;
  align-items: center;
  gap: 8px;
}
.motor-group img {
  width: 90px;
  filter: drop-shadow(0 4px 6px rgba(0,0,0,0.15));
}
.motor-label {
  font-weight: 600;
  color: #1b6e2a;
}

/* ANIMASI MOTOR */
.driving {
  animation: driveFull 4.3s ease-in-out forwards;
}

@keyframes driveFull {
  0% { transform: translateX(0); }
  50% { transform: translateX(42vw); }
  100% { transform: translateX(53vw); }
}

/* MASUK PORTAL */
.enter-portal {
  animation: enterPortal 1.1s ease forwards;
}
@keyframes enterPortal {
  to { opacity: 0; transform: translateX(58vw) scale(.8); }
}

/* GAGAL LOGIN */
.spin-fail {
  animation: spinFail 1s linear infinite;
}
@keyframes spinFail {
  to { transform: translateX(50vw) rotate(360deg); }
}

.smoke {
  position: absolute;
  bottom: calc(22vh + 5px);
  left: calc(50vw + 18px);
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: rgba(100,100,100,0.3);
  filter: blur(3px);
  opacity: 0;
}
.smoke.s1 { animation: smoke1 1.2s ease forwards; }
.smoke.s2 { animation: smoke2 1.5s ease forwards 0.2s; }

@keyframes smoke1 {
  0% { opacity: 0; transform: translateY(0) scale(.6); }
  20% { opacity: .8; }
  100% { opacity: 0; transform: translateY(-40px) scale(1.4); }
}
@keyframes smoke2 {
  0% { opacity: 0; transform: translateY(0) scale(.7); }
  20% { opacity: .9; }
  100% { opacity: 0; transform: translateY(-55px) scale(1.6); }
}

</style>
</head>

<body>

<!-- ===================== FORM LOGIN ===================== -->
<div class="card" id="loginCard">
  <h2 class="title-love">PT ANISA JAYA UTAMA</h2>
  <div class="subtitle">Login Pengguna</div>

  <div class="input-group">
    <input type="text" id="username" placeholder="Username" />
  </div>
  
  <div class="input-group">
    <input type="password" id="password" placeholder="Password" />
    <span id="togglePass" class="toggle-pass">üëÅÔ∏è</span>
  </div>

  <button id="btnLogin">Masuk</button>

  <p style="margin-top:10px;">
    Belum punya akun? <a href="register.html">Daftar di sini</a>
  </p>
</div>

<!-- ===================== LOADING ANIMATION ===================== -->
<div id="loadingOverlay">
  <div class="scene-wrap">
    <img id="monkeyBig" src="assets/monyet_mikir.png">

    <div class="road"></div>

    <div class="motor-group" id="motorGroup">
      <img id="motorImg" src="assets/monyet_motor.png">
      <div class="motor-label">kamu otw üëâ</div>
    </div>

    <div class="smoke" id="smoke1"></div>
    <div class="smoke" id="smoke2"></div>
  </div>
</div>

<script>
const API_URL =
  "https://script.google.com/macros/s/AKfycbwAH7TUpCMajOE3Mtuz0ELcsXVurKQkFz2e5vPVVf4IT4JPHhoErMvO9A-i0A4cGB4q/exec";

const card = document.getElementById("loginCard");
const overlay = document.getElementById("loadingOverlay");
const monkeyBig = document.getElementById("monkeyBig");
const motorGroup = document.getElementById("motorGroup");
const smoke1 = document.getElementById("smoke1");
const smoke2 = document.getElementById("smoke2");

function setSession(u){
  try{ localStorage.setItem("aj_user", JSON.stringify(u)); }catch{}
}

async function api(action, payload={}){
  try{
    const res = await fetch(API_URL,{
      method:"POST",
      headers:{ "Content-Type":"text/plain;charset=utf-8" },
      body:JSON.stringify({action, ...payload})
    });
    return await res.json();
  } catch {
    return { success:false };
  }
}

/* ============= PASSWORD TOGGLE ============= */
document.getElementById("togglePass").onclick = () => {
  const p = document.getElementById("password");
  p.type = p.type === "password" ? "text" : "password";
};

/* ============= SHOW LOADING ============= */
function showOverlay(){
  card.style.display = "none";
  overlay.style.display = "flex";
  monkeyBig.src = "assets/monyet_mikir.png";

  smoke1.className = "smoke";
  smoke2.className = "smoke";

  motorGroup.classList.remove("driving","enter-portal","spin-fail");
  motorGroup.style.transform = "translateX(0)";

  setTimeout(()=>{
    motorGroup.classList.add("driving");
  },150);
}

/* ============= LOGIN SUKSES ============= */
function loginSuccess(user){
  monkeyBig.src = "assets/monyet_senang.png";

  motorGroup.classList.remove("driving");
  motorGroup.classList.add("enter-portal");

  setTimeout(()=>{
    setSession(user);
    window.location.href = "dashboard.html";
  },1400);
}

/* ============= LOGIN GAGAL ============= */
function loginFail(){
  monkeyBig.src = "assets/monyet_salah.png";

  motorGroup.classList.remove("driving");
  motorGroup.classList.add("spin-fail");

  smoke1.classList.add("s1");
  smoke2.classList.add("s2");

  setTimeout(()=>{
    overlay.style.display="none";
    card.style.display="block";
  },2300);
}

/* ============= LOGIN BUTTON ============= */
document.getElementById("btnLogin").onclick = async () => {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();

  if(!username || !password){
    alert("Isi username dan password!");
    return;
  }

  showOverlay();

  const res = await api("login",{ username,password });

  if(res.success) loginSuccess(res.user);
  else loginFail();
};
</script>

</body>
</html>
