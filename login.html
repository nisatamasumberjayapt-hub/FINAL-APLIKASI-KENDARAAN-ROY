<script>
  const btn = document.getElementById('btnLogin');
  const pass = document.getElementById('password');
  const user = document.getElementById('username');
  const toggle = document.getElementById('togglePass');
  const layer = document.getElementById('loadingLayer');

  // ðŸ‘ï¸ Toggle password
  toggle.addEventListener('click', () => {
    if (pass.type === 'password') {
      pass.type = 'text';
      toggle.textContent = 'ðŸ™ˆ';
    } else {
      pass.type = 'password';
      toggle.textContent = 'ðŸ‘ï¸';
    }
  });

  // Tekan Enter = klik login
  [user, pass].forEach(el => el.addEventListener('keydown', e => {
    if (e.key === 'Enter') btn.click();
  }));

  // Fungsi login
  btn.addEventListener('click', async () => {
    if (typeof api !== 'function' || typeof login !== 'function') {
      alert("âš ï¸ File main.js belum termuat. Coba reload (Ctrl+F5).");
      return;
    }

    const u = user.value.trim();
    const p = pass.value.trim();
    if (!u || !p) {
      alert('Isi username dan password!');
      return;
    }

    // ðŸŒŸ Tampilkan animasi loading dulu
    layer.style.display = 'flex';

    try {
      const res = await api('login', { username: u, password: p });

      if (res.success) {
        // Simpan sesi pengguna dan delay biar animasi sempat tampil
        localStorage.setItem('aj_user', JSON.stringify(res.user));
        setTimeout(() => {
          location.href = 'dashboard.html';
        }, 1500);
      } else {
        // Login gagal â†’ sembunyikan animasi dan tampilkan pesan
        layer.style.display = 'none';
        alert(res.message || 'Username atau password salah');
      }
    } catch (err) {
      layer.style.display = 'none';
      alert('Terjadi kesalahan koneksi ke server!');
      console.error(err);
    }
  });
</script>
