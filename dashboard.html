<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard | PT ANISA JAYA UTAMA ‚Äî BY ROY</title>
  <style>
    :root {
      --accent:#0c5d27; --accent2:#13904a;
      --danger:#c0392b; --warn:#f1c40f; --ok:#2ecc71;
      --gray:#ddd; --soft:#f6faf7;
    }
    *{box-sizing:border-box;font-family:"Poppins",sans-serif}
    body{background:var(--soft);margin:0;color:#123}
    header{background:var(--accent);color:#fff;padding:12px 18px;display:flex;justify-content:space-between;align-items:center}
    header a{color:#fff;text-decoration:none;margin-left:16px;font-weight:500}

    main{max-width:1500px;margin:38px auto;padding:0 20px;}
    .card{background:#fff;border-radius:14px;box-shadow:0 5px 15px rgba(0,0,0,.08);padding:26px;transition:.2s}
    .card:hover{transform:translateY(-2px)}

    h2{margin-top:0;margin-bottom:22px;text-align:center;color:var(--accent);font-size:20px}
    h2 span{font-size:22px;margin-right:6px}

    .toolbar{display:flex;align-items:center;gap:8px;margin-bottom:16px;position:relative}
    #searchInput{
      flex:1;padding:11px 13px;border-radius:8px;border:1.6px solid #dbe5dc;font-size:14px;
    }
    #refreshBtn,#clearSearch{
      border:none;border-radius:6px;padding:8px 10px;font-size:14px;color:#fff;cursor:pointer;transition:.2s;
      display:flex;align-items:center;justify-content:center;
    }
    #refreshBtn{background:var(--accent)}
    #refreshBtn:hover{background:var(--accent2)}
    #clearSearch{
      background:#c0392b;display:none;
    }
    #clearSearch:hover{background:#e74c3c}

    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{padding:12px 14px;border-bottom:1px solid #e0ebe0;vertical-align:top;text-align:left}
    thead th{background:var(--accent);color:#fff;text-transform:uppercase;font-size:14px;position:sticky;top:0;z-index:2}
    tbody tr:hover{background:#f8fbf8}

    .dot{width:10px;height:10px;border-radius:3px;display:inline-block;margin-right:5px}
    .legend{display:flex;align-items:center;gap:18px;margin-top:12px;font-size:13px;color:#333}
    .legend span{display:flex;align-items:center}
    .legend .dot{margin-right:5px}

    #toast-container{
      position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
      display:flex;flex-direction:column;align-items:center;z-index:9999;pointer-events:none;
    }
    .toast{
      background:#fff;padding:14px 18px;border-radius:12px;
      box-shadow:0 4px 18px rgba(0,0,0,0.15);
      font-weight:600;min-width:250px;text-align:center;
      border-left:6px solid var(--accent);
      animation:fadeIn .4s ease;
      margin-top:8px;
    }
    .toast.success{border-color:var(--ok)}
    .toast.error{border-color:var(--danger)}
    .toast.warn{border-color:var(--warn)}
    @keyframes fadeIn{from{opacity:0;transform:translate(-50%,-60%);}to{opacity:1;transform:translate(-50%,-50%);}}

  </style>
</head>
<body onload="initDashboard()">
  <header>
    <div><strong>üöó PT ANISA JAYA UTAMA ‚Äî BY ROY</strong></div>
    <nav>
      <a href="kendaraan.html">üöò Kendaraan</a>
      <a href="user.html">üë§ User</a>
      <a href="login.html">üîí Logout</a>
    </nav>
  </header>

  <main>
    <section class="card">
      <h2><span>üìä</span>DAFTAR KENDARAAN</h2>

      <div class="toolbar">
        <input id="searchInput" type="text" placeholder="üîç Cari kendaraan (Plat Nomor / Letak)">
        <button id="clearSearch" title="Hapus pencarian">‚ùå</button>
        <button id="refreshBtn" title="Segarkan data">üîÑ</button>
      </div>

      <div class="table-wrap" style="max-height:700px;overflow:auto;border-radius:10px;border:1px solid #e3eee3;box-shadow:inset 0 0 8px rgba(0,0,0,0.05);">
        <table id="tblKendaraan">
          <thead>
            <tr>
              <th>üî† PLAT NOMOR</th>
              <th>üìç LETAK</th>
              <th>üßæ STNK</th>
              <th>üõû KIR</th>
              <th>üîß SERVIS TERAKHIR</th>
              <th>üí∞ PAJAK 5 TAHUNAN</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="7" align="center">Memuat data...</td></tr>
          </tbody>
        </table>
      </div>

      <div class="legend">
        <span><span class="dot" style="background:var(--ok)"></span> Aman</span>
        <span><span class="dot" style="background:var(--warn)"></span> Peringatan (‚â§10 hari / Servis ‚â•3 bulan)</span>
        <span><span class="dot" style="background:var(--danger)"></span> Lewat (STNK/KIR/Pajak habis)</span>
      </div>
    </section>
  </main>

  <div id="toast-container"></div>
  <script src="main.js?v=7.5"></script>
  <script>
    const $ = id => document.getElementById(id);

    function showToast(msg,type="info",dur=3000){
      const box=document.createElement("div");
      box.className="toast "+type;
      box.textContent=msg;
      $("toast-container").appendChild(box);
      setTimeout(()=>box.remove(),dur);
    }

    async function initDashboard(){
      const user = getSession();
      if(!user) return location.href = "login.html";

      const refresh = $("refreshBtn");
      const input = $("searchInput");
      const clear = $("clearSearch");

      refresh.onclick = loadData;
      input.addEventListener("input", filter);
      clear.addEventListener("click", ()=>{ input.value=""; filter(); });

      await loadData();
    }

    async function loadData(){
      const tbl = document.querySelector("#tblKendaraan tbody");
      tbl.innerHTML = `<tr><td colspan="7" align="center">Memuat data...</td></tr>`;
      const res = await api("getKendaraan");

      if(!res.success || !Array.isArray(res.data)){
        tbl.innerHTML = `<tr><td colspan="7" align="center">‚ùå Gagal memuat data kendaraan</td></tr>`;
        return;
      }

      renderTabelKendaraan(res.data, false);
    }

    function filter(){
      const val = $("searchInput").value.toLowerCase();
      const clear = $("clearSearch");
      clear.style.display = val ? "inline-block" : "none";

      document.querySelectorAll("#tblKendaraan tbody tr").forEach(row=>{
        const plat = row.cells[0]?.innerText.toLowerCase() || "";
        const letak = row.cells[1]?.innerText.toLowerCase() || "";
        row.style.display = (plat.includes(val) || letak.includes(val)) ? "" : "none";
      });
    }
  </script>
</body>
</html>
